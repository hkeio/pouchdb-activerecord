!function(t,e){for(var n in e)t[n]=e[n]}(exports,function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=2)}([function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,o){function s(t){try{a(i.next(t))}catch(t){o(t)}}function u(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,u)}a((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){function n(n){return function(s){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,r&&(o=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(r,n[1])).done)return o;switch(r=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,r=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(o=u.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){u.label=n[1];break}if(6===n[0]&&u.label<o[1]){u.label=o[1],o=n;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(n);break}o[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],r=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}var i,r,o,s,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e.prototype.one=function(t){return void 0===t&&(t=!0),r(this,void 0,void 0,function(){var e,n;return o(this,function(i){switch(i.label){case 0:return e={fields:null,limit:1,selector:this.params.where,sort:null,skip:0},this.params.fields.length&&(e.fields=this.params.fields),this.params.sort.length&&(e.sort=this.params.sort),[4,this.db.find(e)];case 1:return(n=i.sent()).docs.length?[2,t?new this.model(n.docs[0]):n.docs[0]]:[2,null]}})})},e.prototype.all=function(t){return void 0===t&&(t=!0),r(this,void 0,void 0,function(){var e,n,i=this;return o(this,function(r){switch(r.label){case 0:return e={fields:null,limit:this.params.limit.end,selector:this.params.where,sort:null,skip:this.params.limit.start},this.params.fields.length&&(e.fields=this.params.fields),this.params.sort.length&&(e.sort=this.params.sort),[4,this.db.find(e)];case 1:return n=r.sent(),[2,t?n.docs.map(function(t){return new i.model(t)}):n.docs]}})})},e}(n(1).ActiveQuery);e.PouchDBActiveQuery=s},function(t,e){!function(t,e){for(var n in e)t[n]=e[n]}(e,function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=3)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){void 0===e&&(e="string"),this.name=t,this.type=e}return t.prototype.init=function(t){var e=this;Object.defineProperty(t,this.name,{get:function(){return t.getAttribute(e.name)},set:function(n){t.setAttribute(e.name,n)}})},t}();e.ModelAttribute=i;var r=function(){function t(t,e){void 0===e&&(e=[]),this._values={},this._class=this.constructor,this._class.addAttributes(e),this._initAttributes(),t&&(this.attributes=t)}return t.addAttributes=function(t){var e=this;t.forEach(function(t){var n=!1,i=null;e._attributes.forEach(function(e,r){t.name===e.name&&(i=r,n=!0)}),n?e._attributes[i]=t:e._attributes.push(t)})},Object.defineProperty(t,"className",{get:function(){return this.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._class.name},enumerable:!0,configurable:!0}),t.prototype._initAttributes=function(){var t=this;this._class._attributes.forEach(function(e){return e.init(t)})},t.defineAttributes=function(t){this._attributes=t},t.prototype.setAttributes=function(t){for(var e=Object.keys(t),n=0,i=e.length;n<i;n++)this._values[e[n]]=t[e[n]]},Object.defineProperty(t.prototype,"attributes",{get:function(){return this._values},set:function(t){this.setAttributes(t)},enumerable:!0,configurable:!0}),t.prototype.setAttribute=function(t,e){this._values[t]=e},t.prototype.getAttribute=function(t){return this._values[t]},t._attributes=[],t}();e.Model=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this._params={fields:[],limit:{start:0,end:void 0},sort:[],where:{}},t.init(),this._db=t.db,this._model=t}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"db",{get:function(){return this._db[this.model.className]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"model",{get:function(){return this._model},enumerable:!0,configurable:!0}),t.prototype.fields=function(t){var e=t;return"string"===t.constructor.name&&(e=[t]),this._params.fields=e,this},t.prototype.sort=function(t){var e=t;return"string"===t.constructor.name&&(e=[t]),this._params.sort=e,this},t.prototype.limit=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=null),this._params.limit.start=t,this._params.limit.end=e,this},t.prototype.where=function(t){return void 0===t&&(t={}),this._params.where=t,this},t}();e.ActiveQuery=i},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),o=function(t){function e(e){var n=t.call(this,e)||this;return n._class.init(),n._initRelations(),n}return i(e,t),Object.defineProperty(e,"db",{get:function(){return this._db},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"db",{get:function(){return this.class.db[this.class.config.tableName]},enumerable:!0,configurable:!0}),e._dbInit=function(){return this.initialized(this.config.tableName),Promise.resolve(!0)},e.initialized=function(t){this._initialized[t]=!0},Object.defineProperty(e,"config",{get:function(){return this._config},set:function(t){var e=this;Object.keys(t).forEach(function(n){e._config[n]=t[n]})},enumerable:!0,configurable:!0}),e.init=function(){this._initialized[this.config.tableName]||(this._config.identifier=this._identifier||this._config.identifier,this._config.tableName=this._tableName||this._config.tableName,this._config.queryClass=this._queryClass||this._config.queryClass,this._dbInit())},e.prototype._initRelations=function(){var t=this;this._class._relations.forEach(function(e){return e.init(t)})},Object.defineProperty(e.prototype,"class",{get:function(){return this._class},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.getAttribute(this._class.config.identifier)},set:function(t){this.id||this.setAttribute(this._class.config.identifier,t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isNewRecord",{get:function(){return!this.id},enumerable:!0,configurable:!0}),e.find=function(){return this.init(),new this.config.queryClass(this)},e.findOne=function(t){if(void 0===t&&(t={}),this.init(),"string"==typeof t){var e={};return e[this.config.identifier]=t,this.find().where(e).one()}return this.find().where(t).one()},e.findAll=function(t){return void 0===t&&(t={}),this.find().where(t).all()},e._relations=[],e._config={identifier:"id",tableName:"ActiveRecord",queryClass:r.ActiveQuery},e._db={},e._initialized={},e}(n(0).Model);e.ActiveRecord=o},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(1)),i(n(2)),i(n(4)),i(n(0))},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,o){function s(t){try{a(i.next(t))}catch(t){o(t)}}function u(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,u)}a((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){function n(n){return function(s){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,r&&(o=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(r,n[1])).done)return o;switch(r=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,r=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(o=u.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){u.label=n[1];break}if(6===n[0]&&u.label<o[1]){u.label=o[1],o=n;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(n);break}o[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],r=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}var i,r,o,s,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var s=n(0),u=n(2),a=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i._label=i._formatLabel(e._label),i}return i(e,t),e.prototype._formatLabel=function(t){var e="s"===t[t.length-1]?t.substr(0,t.length-1):t,n="s"===t[t.length-1]?t:t+"s";return{original:t,singular:e,plural:n,capitalizedSingular:e[0].toUpperCase()+e.slice(1),capitalizedPlural:n[0].toUpperCase()+n.slice(1)}},e.hasOne=function(t,e,n){return new this({_child:e,_label:t,_property:n,_type:1})},e.hasMany=function(t,e,n){return new this({_child:e,_label:t,_property:n,_type:2})},e.manyToMany=function(t,e,n,i,r){return new this({_child:e,_foreignKey:r,_intermediate:n,_key:i,_label:t,_type:3})},e.prototype.init=function(t){var e={};1===this._type?this._initHasOne(t,e):2===this._type?this._initHasMany(t,e):3===this._type&&this._initManyToMany(t,e)},e.prototype._initHasOne=function(t,e){var n=this;t.class.addAttributes([new s.ModelAttribute(this._property,"string")]),t.setAttribute(this._property,null),Object.defineProperty(t,this._label.original,{get:function(){return n._child.findOne(t[n._property])}}),t["set"+this._label.capitalizedSingular]=function(e){return r(n,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return e instanceof this._child||(e=new this._child(e)),[4,e.save()];case 1:return n.sent(),t[this._property]=e.id,[2]}})})}},e.prototype._initHasMany=function(t,e){var n=this;this._child.addAttributes([new s.ModelAttribute(this._property,"foreignKey")]),Object.defineProperty(t,this._label.plural,{get:function(){return r(n,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return e[this._property]=t.id,[4,new t.class.config.queryClass(this._child).where(e).all()];case 1:return[2,n.sent()]}})})}}),t["get"+this._label.capitalizedPlural]=function(){return r(n,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return e[this._property]=t.id,[4,new t.class.config.queryClass(this._child).where(e)];case 1:return[2,n.sent()]}})})},t["add"+this._label.capitalizedSingular]=function(e){return r(n,void 0,void 0,function(){return o(this,function(n){return[2,t["add"+this._label.capitalizedPlural]([e])]})})},t["add"+this._label.capitalizedPlural]=function(e){return r(n,void 0,void 0,function(){var n=this;return o(this,function(i){switch(i.label){case 0:return e.length?(e=e.map(function(e){return e[n._property]=t.id,e}),[4,this._child.save(e)]):[2];case 1:return i.sent(),[2]}})})}},e.prototype._initManyToMany=function(t,e){var n=this;this._intermediate.addAttributes([new s.ModelAttribute(this._foreignKey,"foreignKey")]),Object.defineProperty(t,this._label.plural,{get:function(){return r(n,void 0,void 0,function(){var n,i,r=this;return o(this,function(o){switch(o.label){case 0:return e[this._key]=t.id,[4,this._intermediate.find().where(e).fields([this._foreignKey]).all(!1)];case 1:return(n=o.sent()).length?(i=n.map(function(t){return t[r._foreignKey]}),[4,new t.class.config.queryClass(this._child).where({_id:{$in:i}}).all()]):[2,[]];case 2:return[2,o.sent()]}})})}}),t["get"+this._label.capitalizedPlural]=function(){return r(n,void 0,void 0,function(){var n,i,r=this;return o(this,function(o){switch(o.label){case 0:return e[this._key]=t.id,[4,this._intermediate.find().where(e).fields([this._foreignKey]).all(!1)];case 1:return(n=o.sent()).length?(i=n.map(function(t){return t[r._foreignKey]}),[4,new t.class.config.queryClass(this._child).where({_id:{$in:i}})]):[2,[]];case 2:return[2,o.sent()]}})})},t["add"+this._label.capitalizedSingular]=function(e){return r(n,void 0,void 0,function(){return o(this,function(n){return[2,t["add"+this._label.capitalizedPlural]([e])]})})},t["add"+this._label.capitalizedPlural]=function(e){return r(n,void 0,void 0,function(){var n,i,r,s,u,a;return o(this,function(o){switch(o.label){case 0:return e.length?[4,this._child.save(e)]:[2];case 1:return o.sent(),n={},n[this._foreignKey]={$in:e.map(function(t){return t.id})},[4,this._intermediate.findAll(n)];case 2:o.sent(),console.log("@todo: check existing"),i=0,r=e,o.label=3;case 3:return i<r.length?(s=r[i],u={},u[this._key]=t.id,u[this._foreignKey]=s.id,a=new this._intermediate(u),[4,a.save()]):[3,6];case 4:o.sent(),o.label=5;case 5:return i++,[3,3];case 6:return[2]}})})}},e._attributes=[new s.ModelAttribute("_child",typeof u.ActiveRecord),new s.ModelAttribute("_foreignKey"),new s.ModelAttribute("_intermediate",typeof u.ActiveRecord),new s.ModelAttribute("_key"),new s.ModelAttribute("_label"),new s.ModelAttribute("_property"),new s.ModelAttribute("_type","number")],e}(s.Model);e.ActiveRecordRelation=a}]))},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(0)),i(n(3))},function(t,e,n){"use strict";var i=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,o){function s(t){try{a(i.next(t))}catch(t){o(t)}}function u(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,u)}a((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){function n(n){return function(s){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,r&&(o=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(r,n[1])).done)return o;switch(r=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return u.label++,{value:n[1],done:!1};case 5:u.label++,r=n[1],n=[0];continue;case 7:n=u.ops.pop(),u.trys.pop();continue;default:if(o=u.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){u=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){u.label=n[1];break}if(6===n[0]&&u.label<o[1]){u.label=o[1],o=n;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(n);break}o[2]&&u.ops.pop(),u.trys.pop();continue}n=e.call(t,u)}catch(t){n=[6,t],r=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}var i,r,o,s,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),u=n(0),a=n(4),c=n(5),l=a.plugin(c),f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e._dbInit=function(){return this.dbConfig.plugins&&this.dbConfig.plugins.forEach(function(t){l=l.plugin(t)}),delete this.dbConfig.plugins,this._db[this.config.tableName]=new l(".db/"+this.config.tableName,this.dbConfig),t.initialized.call(this,this.config.tableName),Promise.resolve(!0)},e.prototype.save=function(){return r(this,void 0,void 0,function(){var t;return o(this,function(e){switch(e.label){case 0:return[4,this.db.post(this.attributes)];case 1:return t=e.sent(),this.setAttribute("_id",t.id),this.setAttribute("_rev",t.rev),[2,this]}})})},e.save=function(t){return r(this,void 0,void 0,function(){var e,n,i,r;return o(this,function(o){switch(o.label){case 0:e=[];for(n in t)e.push(n);i=0,o.label=1;case 1:return i<e.length?(r=e[i],t[r]instanceof this||(t[r]=new this(t[r])),[4,t[r].save()]):[3,4];case 2:o.sent(),o.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},e._identifier="_id",e._tableName="PouchDbActiveRecord",e._queryClass=u.PouchDBActiveQuery,e._db={},e.dbConfig={},e._attributes=[new s.ModelAttribute("_id"),new s.ModelAttribute("_rev")],e}(s.ActiveRecord);e.PouchDbActiveRecord=f},function(t,e){t.exports=require("pouchdb")},function(t,e){t.exports=require("pouchdb-find")}]));